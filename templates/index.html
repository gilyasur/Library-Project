<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="../static/function.js"></script>
</head>
<body>
    <h1>Welcome to the Library</h1>
    <button onclick="displayBooks()">Books List</button>
    <button onclick="displayLoans()">Show Loans</button>
    <button onclick="displayCustomers()">Show customers</button>
    <div id="display"></div>

    <button class="btn btn-primary" onclick="showBookForm()">Press to add Book </button><br>
    <button class="btn btn-primary" onclick="showCustomerForm()">Press to add Customer </button><br>
    <button class="btn btn-primary" onclick="showLoanForm()">Press to add Loan </button><br>
    
    <div id="bookForm" style="display: none;">
        Name of Book <input type="text" id="boo_name"><br>
        Author of Book <input type="text" id="boo_author"><br>
        Year of publication <input type="text" id="boo_year_published"><br>
        Book Loan Period
        <select name="boo_loan_type" id="boo_loan_type">
            <option value="1">10 days</option>
            <option value="2">5 days</option>
            <option value="3">2 days</option>
        </select>
        <button class="btn btn-primary" onclick="add_book()">Add</button><br>
    </div>
    <div id="customerForm" style="display: none;">
        Name of Customer <input type="text" id="cust_name"><br>
        City of Customer <input type="text" id="cust_city"><br>
        Age of Customer <input type="text" id="cust_age"><br>
        
        <button class="btn btn-primary" onclick="add_customer()">Add</button><br>
    </div>
    <script>
const MY_SERVER = "http://127.0.0.1:5000/"
let index= 0
let books = []
let customers = []
let loans = []
let loan_type_js = ""
const get_data_books = async () => {
    try {
        const res = await axios.get(`${MY_SERVER}books/get`);
        const books = res.data;
        console.log(books); // Log the API response

        // Default value for loan_type_js if loan_type is missing
        const loanType = books.loan_type || 0; // Assuming 0 is a suitable default
        
        if (loanType == 1) { loan_type_js = "10 days"; }
        else if (loanType == 2) { loan_type_js = "5 days"; }
        else { loan_type_js = "2 days"; }

        return books;
    } catch (error) {
        console.error('Error fetching books:', error);
        throw error;
    }
}
const get_data_customers = async () => {
    try {
        const res = await axios.get(`${MY_SERVER}customers/get`);
        customers = res.data;
        return customers;
    } catch (error) {
        console.error('Error fetching customers:', error);
        throw error;
    }
}
const get_data_loans = async () => {
    try {
        const res = await axios.get(`${MY_SERVER}loans/get`);
        loans = res.data;
        return loans;
    } catch (error) {
        console.error('Error fetching loans:', error);
        throw error;
    }
}



function get_all_data(){
    get_data_books();
    get_data_customers();
    get_data_loans();
}
get_all_data()

const del_book = async (id) => {
    try {
        const response = await axios.delete(`${MY_SERVER}/books/delete/${id}`);
        console.log(response.data); // Log the success message or handle it as needed
        // Optionally, you can refresh the books list or update the UI after a successful delete
        displayBooks(); // Example: Refresh the books list
    } catch (error) {
        console.error('Error deleting book:', error);
    }
}
const del_customer = async (id) => {
    try {
        const response = await axios.delete(`${MY_SERVER}/customers/delete/${id}`);
        console.log(response.data); 
        
        displayCustomers(); 
    } catch (error) {
        console.error('Error deleting book:', error);
    }
}

const updateCustomer = async (id, newName, newCity, newAge) => {
    try {
        const response = await axios.patch(`${MY_SERVER}/customers/update/${id}`, {
            name: newName,
            city: newCity,
            age: newAge
        });
        console.log(response.data); 
        
        displayCustomers(); 
    } catch (error) {
        console.error('Error updating customer:', error);
    }
}





    </script>
</body>
</html>